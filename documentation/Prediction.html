<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Making Predictions &mdash; ELEKTRONN</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1rc',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/elektronnfavicon.ico"/>
    <link rel="top" title="ELEKTRONN" href="index.html" />
    <link rel="next" title="Tips for Adaptation and Extending" href="NetCore.html" />
    <link rel="prev" title="Lazy Labels" href="Lazy.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="index.html"><img src="_static/elektronn.png" border="0" alt="sampledoc"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="NetCore.html" title="Tips for Adaptation and Extending"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Lazy.html" title="Lazy Labels"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ELEKTRONN</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Making Predictions</a><ul>
<li><a class="reference internal" href="#general">General</a></li>
<li><a class="reference internal" href="#max-fragment-pooling-mfp">Max Fragment Pooling (MFP)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Lazy.html"
                        title="previous chapter">Lazy Labels</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="NetCore.html"
                        title="next chapter">Tips for Adaptation and Extending</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Prediction.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="making-predictions">
<h1>Making Predictions<a class="headerlink" href="#making-predictions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>Once a CNN/NN is trained predictions can be made. For CNNs prediction speed benefits greatly from larger input patch sizes and MFP (see below). Therefore it is recommended to create a new CNN/NN instance using <code class="xref py py-func docutils literal"><span class="pre">training.predictor.create_predncnn()</span></code> where the size from training can be overridden and the parameters are loaded from the <code class="docutils literal"><span class="pre">*-LAST.param</span></code>-file in the save directory. The same config file as for the training can be used.</p>
<p>The returned CNN/NN is a completely normal network object which you can use in your own prediction script; you script just has to provide you data in the correct format:</p>
<blockquote>
<div><ul class="simple">
<li>For images the convenience method <code class="xref py py-meth docutils literal"><span class="pre">net.convnet.MixedConvNN.predictDense()</span></code> is available which creates <em>dense</em> predictions for images/volumes of arbitrary sizes (the must however be larger than the input size). Normally the predictions have some offset (caused from the convolutions) but there exists an option to mirror the raw data such that the returned prediction covers the full extent of the input image (this might however introduce some artifacts because the mirroring is not a natural continuation of the image).</li>
<li>For non-image data predictions can be made using simply <code class="docutils literal"><span class="pre">cnn.class_probabilities()</span></code> (make sure to prepare your test data in the required input shape).</li>
</ul>
</div></blockquote>
<p>You should experiment a bit with the input size to get optimal prediction speeds. There is a script similar to <code class="docutils literal"><span class="pre">elektronn-train</span></code> called <code class="docutils literal"><span class="pre">elektronn-profile</span></code> which does that job for you: pass a configuration file as commandline argument and the script loops over various input sizes and creates a <code class="docutils literal"><span class="pre">csv</span></code>-table of the respective speeds. You can find the fastest input size, that just fits in your RAM in that table and use it for making predictions.</p>
<p>Theoretically predicting the whole array in one go, instead of several tiles, would be fastest. For each tile some calculations have to be repeated and the larger the tiles the more intermediate results can be shared. But this is usually impossible due to limited GPU-RAM.</p>
</div>
<div class="section" id="max-fragment-pooling-mfp">
<span id="mfp"></span><h2>Max Fragment Pooling (MFP)<a class="headerlink" href="#max-fragment-pooling-mfp" title="Permalink to this headline">¶</a></h2>
<p>MFP is the computationally optimal way to avoid redundant calculations when making predictions with strided output (as arises from pooling).
It requires more GPU RAM (you may need to adjust the input size) but can speed up predictions by a factor of 2 - 10. The larger the patch size (i.e. the more RAM you have) the faster.
Compilation time is significantly longer.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="NetCore.html" title="Tips for Adaptation and Extending"
             >next</a> |</li>
        <li class="right" >
          <a href="Lazy.html" title="Lazy Labels"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ELEKTRONN</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Gregor Urban, Marius F Killinger.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>